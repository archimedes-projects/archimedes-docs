(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{101:function(e,n,t){"use strict";function a(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(r&&(r+=" "),r+=t);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}n.a=function(){for(var e,n,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(r&&(r+=" "),r+=n);return r}},102:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return m}));var a=t(0),r=t.n(a);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=r.a.createContext({}),u=function(e){var n=r.a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},b=function(e){var n=u(e.components);return r.a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=r.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=u(t),d=a,m=b["".concat(c,".").concat(d)]||b[d]||p[d]||i;return t?r.a.createElement(m,o(o({ref:n},s),{},{components:t})):r.a.createElement(m,o({ref:n},s))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,c=new Array(i);c[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,c[1]=o;for(var s=2;s<i;s++)c[s]=t[s];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},109:function(e,n,t){"use strict";var a=t(0),r=t(110);n.a=function(){var e=Object(a.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},110:function(e,n,t){"use strict";var a=t(0),r=Object(a.createContext)(void 0);n.a=r},119:function(e,n,t){"use strict";var a=t(0),r=t.n(a),i=t(109),c=t(101),o=t(62),l=t.n(o),s=37,u=39;n.a=function(e){var n=e.lazy,t=e.block,o=e.defaultValue,b=e.values,p=e.groupId,d=e.className,m=Object(i.a)(),h=m.tabGroupChoices,f=m.setTabGroupChoices,j=Object(a.useState)(o),O=j[0],g=j[1],v=a.Children.toArray(e.children);if(null!=p){var y=h[p];null!=y&&y!==O&&b.some((function(e){return e.value===y}))&&g(y)}var N=function(e){g(e),null!=p&&f(p,e)},k=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(c.a)("tabs",{"tabs--block":t},d)},b.map((function(e){var n=e.value,t=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":O===n,className:Object(c.a)("tabs__item",l.a.tabItem,{"tabs__item--active":O===n}),key:n,ref:function(e){return k.push(e)},onKeyDown:function(e){!function(e,n,t){switch(t.keyCode){case u:!function(e,n){var t=e.indexOf(n)+1;e[t]?e[t].focus():e[0].focus()}(e,n);break;case s:!function(e,n){var t=e.indexOf(n)-1;e[t]?e[t].focus():e[e.length-1].focus()}(e,n)}}(k,e.target,e)},onFocus:function(){return N(n)},onClick:function(){N(n)}},t)}))),n?Object(a.cloneElement)(v.filter((function(e){return e.props.value===O}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,n){return Object(a.cloneElement)(e,{key:n,hidden:e.props.value!==O})}))))}},120:function(e,n,t){"use strict";var a=t(0),r=t.n(a);n.a=function(e){var n=e.children,t=e.hidden,a=e.className;return r.a.createElement("div",{role:"tabpanel",hidden:t,className:a},n)}},88:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return l})),t.d(n,"metadata",(function(){return s})),t.d(n,"toc",(function(){return u})),t.d(n,"default",(function(){return p}));var a=t(3),r=t(7),i=(t(0),t(102)),c=t(119),o=t(120),l={title:"Arch"},s={unversionedId:"js/arch",id:"js/arch",isDocsHomePage:!1,title:"Arch",description:"Installation",source:"@site/docs/js/arch.mdx",slug:"/js/arch",permalink:"/docs/js/arch",editUrl:"https://github.com/archimedes-projects/archimedes-docs/edit/master/docs/js/arch.mdx",version:"current",sidebar:"js",previous:{title:"Installation",permalink:"/docs/js/installation"},next:{title:"Utils",permalink:"/docs/js/utils"}},u=[{value:"Installation",id:"installation",children:[]},{value:"Runner",id:"runner",children:[]},{value:"Links",id:"links",children:[]},{value:"ExecutorLink",id:"executorlink",children:[]},{value:"LoggerLink",id:"loggerlink",children:[]},{value:"NotificationLink",id:"notificationlink",children:[{value:"CacheLink",id:"cachelink",children:[]}]},{value:"NullLink",id:"nulllink",children:[]},{value:"EmptyLink",id:"emptylink",children:[]}],b={toc:u};function p(e){var n=e.components,t=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"installation"},"Installation"),Object(i.b)("p",null,"You can install whatever packages you need:"),Object(i.b)(c.a,{defaultValue:"npm",values:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],mdxType:"Tabs"},Object(i.b)(o.a,{value:"npm",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"npm i @archimedes/arch -SE\n"))),Object(i.b)(o.a,{value:"yarn",mdxType:"TabItem"},Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},"yarn add @archimedes/arch -E\n")))),Object(i.b)("h2",{id:"runner"},"Runner"),Object(i.b)("p",null,"The runner configures a ",Object(i.b)("a",{parentName:"p",href:"https://refactoring.guru/design-patterns/chain-of-responsibility"},"chain of responsibility")," which allows a use case to be processed through links. In order to create the chain you have to do this as soon as possible in your app:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"Runner.createChain([loggerLink, executorLink])\n")),Object(i.b)("p",null,"You can configure the chain however you can, even dynamically:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"if (isProduction) {\n  Runner.createChain([executorLink])\n} else {\n  Runner.createChain([executorLink, loggerLink])\n}\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"The ",Object(i.b)("inlineCode",{parentName:"p"},"executor-link")," is always required, even if you use the ",Object(i.b)("inlineCode",{parentName:"p"},"cache-link"),"."))),Object(i.b)("p",null,"A complete chain looks like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"Runner.createChain([\n  new CacheLink(new CacheManager()),\n  new ExecutorLink(),\n  new LoggerLink(console),\n  new NotificationLink(new NotificationCenter())\n])\n")),Object(i.b)("h2",{id:"links"},"Links"),Object(i.b)("h2",{id:"executorlink"},"ExecutorLink"),Object(i.b)("p",null,"This link merely executes the use case. It is always needed if you want to execute the use cases."),Object(i.b)("h2",{id:"loggerlink"},"LoggerLink"),Object(i.b)("p",null,"This link logs information about the execution of the use case, like parameters, result and name of the use case:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-text"},"BazQry\n  Parameters: -\n  Result:\n      42\n")),Object(i.b)("p",null,"It receives an object that conforms the Logger interface:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"export interface Logger {\n  log<T>(message: T): void\n}\n")),Object(i.b)("p",null,"For example, the ",Object(i.b)("inlineCode",{parentName:"p"},"window.console")," conforms that interface, so you can either use that:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"// Local logger\nnew LoggerLink(console)\n")),Object(i.b)("p",null,"or any other implementation, like a custom remote logger:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"class RemoteLogger implements Logger {\n  log<T>(message: T): void {\n    fetch('remote.logger.com', { body: message })\n  }\n}\n\nnew LoggerLink(new RemoteLogger())\n")),Object(i.b)("h2",{id:"notificationlink"},"NotificationLink"),Object(i.b)("p",null,"This link is meant to capture errors occurred when executing a use case. This link should be placed after ",Object(i.b)("inlineCode",{parentName:"p"},"ExecutorLink"),". When an error occurs it will notify the ",Object(i.b)("inlineCode",{parentName:"p"},"NotificationCenter"),". From the UI you can subscribe to the ",Object(i.b)("inlineCode",{parentName:"p"},"NotificationCenter")," in order to show the user an error message:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"import { NotificationCenter } from './notification-center'\nimport { Subscriber } from './subscriber'\n\nclass ErrorAlerter implements Subscriber {\n  update(publisher: NotificationCenter) {\n    publisher.notifications.map(x => ({\n      ...x,\n      message: x.message ?? 'Error'\n    }))\n  }\n}\n\nnew NotificationCenter().register(new ErrorAlerter())\n")),Object(i.b)("h3",{id:"cachelink"},"CacheLink"),Object(i.b)("h4",{id:"cache-eviction"},"Cache eviction"),Object(i.b)("p",null,"You can automatically evict the cache of dependant use cases using the ",Object(i.b)("inlineCode",{parentName:"p"},"EvictCache")," decorator in conjunction with the ",Object(i.b)("inlineCode",{parentName:"p"},"cache-link")," link. If use case ",Object(i.b)("inlineCode",{parentName:"p"},"a")," depends on use case ",Object(i.b)("inlineCode",{parentName:"p"},"b"),", and use case ",Object(i.b)("inlineCode",{parentName:"p"},"b")," depends on use case ",Object(i.b)("inlineCode",{parentName:"p"},"c")," (",Object(i.b)("inlineCode",{parentName:"p"},"a")," \u27a1 ",Object(i.b)("inlineCode",{parentName:"p"},"b")," \u27a1 ",Object(i.b)("inlineCode",{parentName:"p"},"c"),"\ufe0f) if we invalidate the cache of use case ",Object(i.b)("inlineCode",{parentName:"p"},"a")," we should evict the cache of use case ",Object(i.b)("inlineCode",{parentName:"p"},"b")," and ",Object(i.b)("inlineCode",{parentName:"p"},"c")," too. We should add this decorator to all use cases we want this handled."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"@EvictCache\nexport class AQry extends Query {\n  constructor(private readonly bQry: BQry) {\n    super()\n  }\n\n  async internalExecute() {\n    return this.bQry.execute()\n  }\n}\n")),Object(i.b)("p",null,"It's important to activate ",Object(i.b)("inlineCode",{parentName:"p"},"emitDecoratorMetadata")," to true in the ",Object(i.b)("inlineCode",{parentName:"p"},"tsconfig.json")," compiler's options. See the ",Object(i.b)("inlineCode",{parentName:"p"},"examples")," directory for more information."),Object(i.b)("h4",{id:"cache-invalidations"},"Cache invalidations"),Object(i.b)("p",null,"If you want to set that certain commands or queries invalidate the cache of other commands and queries you can set the cache invalidations the ",Object(i.b)("inlineCode",{parentName:"p"},"CacheInvalidations")," class:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"CacheInvalidations.set(FooCmd.name, [BarQry.name])\n")),Object(i.b)("p",null,"You can also use these invalidation policies:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"ALL: The use case will invalidate all the cache of all the use cases"),Object(i.b)("li",{parentName:"ul"},"NO_CACHE: The use case will never be cached")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-ts"},"CacheInvalidations.set(FooCmd.name, [InvalidationPolicy.ALL])\n")),Object(i.b)("h2",{id:"nulllink"},"NullLink"),Object(i.b)("p",null,"This link throws an error when is called."),Object(i.b)("h2",{id:"emptylink"},"EmptyLink"),Object(i.b)("p",null,"This link does nothing when called."))}p.isMDXComponent=!0}}]);