(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{111:function(e,n,a){"use strict";var t=a(0),i=a.n(t),c=a(106),r=a(93),o=a(63),l=a.n(o),s=37,b=39;n.a=function(e){var n=e.lazy,a=e.block,o=e.defaultValue,u=e.values,d=e.groupId,p=e.className,m=Object(c.a)(),h=m.tabGroupChoices,j=m.setTabGroupChoices,O=Object(t.useState)(o),g=O[0],f=O[1],v=t.Children.toArray(e.children);if(null!=d){var N=h[d];null!=N&&N!==g&&u.some((function(e){return e.value===N}))&&f(N)}var k=function(e){f(e),null!=d&&j(d,e)},C=[];return i.a.createElement("div",null,i.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(r.a)("tabs",{"tabs--block":a},p)},u.map((function(e){var n=e.value,a=e.label;return i.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":g===n,className:Object(r.a)("tabs__item",l.a.tabItem,{"tabs__item--active":g===n}),key:n,ref:function(e){return C.push(e)},onKeyDown:function(e){!function(e,n,a){switch(a.keyCode){case b:!function(e,n){var a=e.indexOf(n)+1;e[a]?e[a].focus():e[0].focus()}(e,n);break;case s:!function(e,n){var a=e.indexOf(n)-1;e[a]?e[a].focus():e[e.length-1].focus()}(e,n)}}(C,e.target,e)},onFocus:function(){return k(n)},onClick:function(){k(n)}},a)}))),n?Object(t.cloneElement)(v.filter((function(e){return e.props.value===g}))[0],{className:"margin-vert--md"}):i.a.createElement("div",{className:"margin-vert--md"},v.map((function(e,n){return Object(t.cloneElement)(e,{key:n,hidden:e.props.value!==g})}))))}},112:function(e,n,a){"use strict";var t=a(0),i=a.n(t);n.a=function(e){var n=e.children,a=e.hidden,t=e.className;return i.a.createElement("div",{role:"tabpanel",hidden:a,className:t},n)}},82:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return l})),a.d(n,"metadata",(function(){return s})),a.d(n,"toc",(function(){return b})),a.d(n,"default",(function(){return d}));var t=a(3),i=a(7),c=(a(0),a(96)),r=a(111),o=a(112),l={title:"Arch"},s={unversionedId:"js/arch",id:"js/arch",isDocsHomePage:!1,title:"Arch",description:"Installation",source:"@site/docs/js/arch.mdx",slug:"/js/arch",permalink:"/docs/js/arch",editUrl:"https://github.com/archimedes-projects/archimedes-docs/edit/main/docs/js/arch.mdx",version:"current",sidebar:"js",previous:{title:"Installation",permalink:"/docs/js/installation"},next:{title:"Utils",permalink:"/docs/js/utils"}},b=[{value:"Installation",id:"installation",children:[]},{value:"Runner",id:"runner",children:[]},{value:"Links",id:"links",children:[]},{value:"ExecutorLink",id:"executorlink",children:[]},{value:"LoggerLink",id:"loggerlink",children:[]},{value:"NotificationLink",id:"notificationlink",children:[{value:"CacheLink",id:"cachelink",children:[]}]},{value:"NullLink",id:"nulllink",children:[]},{value:"EmptyLink",id:"emptylink",children:[]}],u={toc:b};function d(e){var n=e.components,a=Object(i.a)(e,["components"]);return Object(c.b)("wrapper",Object(t.a)({},u,a,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"installation"},"Installation"),Object(c.b)("p",null,"You can install whatever packages you need:"),Object(c.b)(r.a,{defaultValue:"npm",values:[{label:"npm",value:"npm"},{label:"Yarn",value:"yarn"}],mdxType:"Tabs"},Object(c.b)(o.a,{value:"npm",mdxType:"TabItem"},Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"npm i @archimedes/arch -SE\n"))),Object(c.b)(o.a,{value:"yarn",mdxType:"TabItem"},Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-bash"},"yarn add @archimedes/arch -E\n")))),Object(c.b)("h2",{id:"runner"},"Runner"),Object(c.b)("p",null,"The runner configures a ",Object(c.b)("a",{parentName:"p",href:"https://refactoring.guru/design-patterns/chain-of-responsibility"},"chain of responsibility")," which allows a use case to be processed through links. In order to create the chain you have to do this as soon as possible in your app:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"Runner.createChain([loggerLink, executorLink])\n")),Object(c.b)("p",null,"You can configure the chain however you can, even dynamically:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"if (isProduction) {\n  Runner.createChain([executorLink])\n} else {\n  Runner.createChain([executorLink, loggerLink])\n}\n")),Object(c.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(c.b)("div",{parentName:"div",className:"admonition-heading"},Object(c.b)("h5",{parentName:"div"},Object(c.b)("span",{parentName:"h5",className:"admonition-icon"},Object(c.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(c.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(c.b)("div",{parentName:"div",className:"admonition-content"},Object(c.b)("p",{parentName:"div"},"The ",Object(c.b)("inlineCode",{parentName:"p"},"executor-link")," is always required, even if you use the ",Object(c.b)("inlineCode",{parentName:"p"},"cache-link"),"."))),Object(c.b)("p",null,"A complete chain looks like this:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"Runner.createChain([\n  new CacheLink(new CacheManager()),\n  new ExecutorLink(),\n  new LoggerLink(console),\n  new NotificationLink(new NotificationCenter())\n])\n")),Object(c.b)("h2",{id:"links"},"Links"),Object(c.b)("h2",{id:"executorlink"},"ExecutorLink"),Object(c.b)("p",null,"This link merely executes the use case. It is always needed if you want to execute the use cases."),Object(c.b)("h2",{id:"loggerlink"},"LoggerLink"),Object(c.b)("p",null,"This link logs information about the execution of the use case, like parameters, result and name of the use case:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-text"},"BazQry\n  Parameters: -\n  Result:\n      42\n")),Object(c.b)("p",null,"It receives an object that conforms the Logger interface:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"export interface Logger {\n  log<T>(message: T): void\n}\n")),Object(c.b)("p",null,"For example, the ",Object(c.b)("inlineCode",{parentName:"p"},"window.console")," conforms that interface, so you can either use that:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"// Local logger\nnew LoggerLink(console)\n")),Object(c.b)("p",null,"or any other implementation, like a custom remote logger:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"class RemoteLogger implements Logger {\n  log<T>(message: T): void {\n    fetch('remote.logger.com', { body: message })\n  }\n}\n\nnew LoggerLink(new RemoteLogger())\n")),Object(c.b)("h2",{id:"notificationlink"},"NotificationLink"),Object(c.b)("p",null,"This link is meant to capture errors occurred when executing a use case. This link should be placed after ",Object(c.b)("inlineCode",{parentName:"p"},"ExecutorLink"),". When an error occurs it will notify the ",Object(c.b)("inlineCode",{parentName:"p"},"NotificationCenter"),". From the UI you can subscribe to the ",Object(c.b)("inlineCode",{parentName:"p"},"NotificationCenter")," in order to show the user an error message:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"import { NotificationCenter } from './notification-center'\nimport { Subscriber } from './subscriber'\n\nclass ErrorAlerter implements Subscriber {\n  update(publisher: NotificationCenter) {\n    publisher.notifications.map(x => ({\n      ...x,\n      message: x.message ?? 'Error'\n    }))\n  }\n}\n\nnew NotificationCenter().register(new ErrorAlerter())\n")),Object(c.b)("h3",{id:"cachelink"},"CacheLink"),Object(c.b)("h4",{id:"cache-eviction"},"Cache eviction"),Object(c.b)("p",null,"You can automatically evict the cache of dependant use cases using the ",Object(c.b)("inlineCode",{parentName:"p"},"EvictCache")," decorator in conjunction with the ",Object(c.b)("inlineCode",{parentName:"p"},"cache-link")," link. If use case ",Object(c.b)("inlineCode",{parentName:"p"},"a")," depends on use case ",Object(c.b)("inlineCode",{parentName:"p"},"b"),", and use case ",Object(c.b)("inlineCode",{parentName:"p"},"b")," depends on use case ",Object(c.b)("inlineCode",{parentName:"p"},"c")," (",Object(c.b)("inlineCode",{parentName:"p"},"a")," \u27a1 ",Object(c.b)("inlineCode",{parentName:"p"},"b")," \u27a1 ",Object(c.b)("inlineCode",{parentName:"p"},"c"),"\ufe0f) if we invalidate the cache of use case ",Object(c.b)("inlineCode",{parentName:"p"},"a")," we should evict the cache of use case ",Object(c.b)("inlineCode",{parentName:"p"},"b")," and ",Object(c.b)("inlineCode",{parentName:"p"},"c")," too. We should add this decorator to all use cases we want this handled."),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"@EvictCache\nexport class AQry extends Query {\n  constructor(private readonly bQry: BQry) {\n    super()\n  }\n\n  async internalExecute() {\n    return this.bQry.execute()\n  }\n}\n")),Object(c.b)("p",null,"It's important to activate ",Object(c.b)("inlineCode",{parentName:"p"},"emitDecoratorMetadata")," to true in the ",Object(c.b)("inlineCode",{parentName:"p"},"tsconfig.json")," compiler's options. See the ",Object(c.b)("inlineCode",{parentName:"p"},"examples")," directory for more information."),Object(c.b)("h4",{id:"cache-invalidations"},"Cache invalidations"),Object(c.b)("p",null,"If you want to set that certain commands or queries invalidate the cache of other commands and queries you can set the cache invalidations the ",Object(c.b)("inlineCode",{parentName:"p"},"CacheInvalidations")," class:"),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"CacheInvalidations.set(FooCmd.name, [BarQry.name])\n")),Object(c.b)("p",null,"You can also use these invalidation policies:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"ALL: The use case will invalidate all the cache of all the use cases"),Object(c.b)("li",{parentName:"ul"},"NO_CACHE: The use case will never be cached")),Object(c.b)("pre",null,Object(c.b)("code",{parentName:"pre",className:"language-ts"},"CacheInvalidations.set(FooCmd.name, [InvalidationPolicy.ALL])\n")),Object(c.b)("h2",{id:"nulllink"},"NullLink"),Object(c.b)("p",null,"This link throws an error when is called."),Object(c.b)("h2",{id:"emptylink"},"EmptyLink"),Object(c.b)("p",null,"This link does nothing when called."))}d.isMDXComponent=!0}}]);